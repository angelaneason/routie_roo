# Routie Roo TODO

## Calendar Badge Update (2025-12-09)
- [x] Replace current calendar badge with full calendar image (—Pngtree—calendariconwithahighlighted_22163766.png)
- [x] Display entire calendar graphic with "ON CALENDAR" header and green checkmark
- [x] Make badge larger and more prominent on route cards and detail pages
- [x] Update single-stop route map to show Routie Roo standing at destination (not holding map pin)
- [x] Change route title format to show: Name Day Date (e.g., "Alisha Gardner Friday 12/12/2025")
- [x] Increase calendar icon size even larger for better visibility (h-24 = 96px)

## Ready to Publish
- [x] Important dates display on waypoints with blank fields for missing values
- [x] Duplicate stop type legend entries fixed

(rest of file continues...)


## Scheduled Contacts Filter (2025-12-09)
- [x] Add "Show scheduled contacts" filter checkbox to contact list
- [x] Implement filter logic to show only contacts with scheduledDays or oneTimeVisits


## Scheduled Contacts Filter Bug Fix (2025-12-09)
- [x] Investigate why contacts with no visible schedule show up in scheduled filter
- [x] Fix filter logic to exclude contacts with empty/null schedule arrays
- [x] Test filter to ensure only truly scheduled contacts appear

## Route Title Simplification (2025-12-09)
- [x] Update route title generation to use format "Name - Day Date" instead of "Name - Day Route - Week of Date Day Date"
- [x] Test with Smart Auto-Routing generated routes

## Auto-Delete Incomplete Routes on Schedule Deletion (2025-12-09)
- [x] Analyze current schedule deletion logic in contacts.updateScheduledDays
- [x] Implement route cleanup to delete incomplete auto-generated routes when schedule is removed
- [x] Keep completed routes for historical records
- [x] Write tests for route cleanup functionality
- [x] Test with various route completion states

## Calendar Integration Issue (2025-12-09)
- [x] Investigate why "Add to Calendar" button is not working
- [x] Check TypeScript errors related to addToCalendar procedure
- [x] Verify OAuth flow and token handling
- [x] Test calendar event creation end-to-end
- [x] Fix any issues preventing calendar integration

## Schedule Deletion Cleanup Not Working (2025-12-09)
- [x] Investigate why deleting schedules doesn't delete incomplete routes
- [x] Check the contacts.updateScheduledDays procedure cleanup logic
- [x] Verify route deletion conditions (isAutoGenerated, completedAt, waypoint count)
- [x] Fix the cleanup logic to properly delete empty incomplete routes
- [x] Test schedule deletion with various route states

## Client Billing System Implementation (2025-12-09)
### Phase 1: Analysis & Design
- [ ] Analyze RoadRunner billing model and adapt for Routie Roo
- [ ] Design multi-route-holder architecture (each route holder manages their own clients)
- [ ] Define client-to-route-holder relationship model
- [ ] Plan billing workflow: route completion → invoice generation → payment tracking

### Phase 2: Database Schema
- [ ] Create clients table with route holder foreign key
- [ ] Add billing fields: mileage_rate, stop_charge_type, stop_charge_amount
- [ ] Add contact info fields: name, email, phone, address
- [ ] Enhance routes table with billing fields: mileage_charge, stop_charge, total_charge
- [ ] Add billing status tracking: unbilled/billed/paid with timestamps
- [ ] Create database migration and push schema

### Phase 3: Backend API
- [ ] Create clients router with CRUD operations
- [ ] Implement client.list filtered by route holder
- [ ] Implement client.create with route holder association
- [ ] Implement client.update and client.delete (soft delete)
- [ ] Add billing calculations to route completion
- [ ] Create invoice generation endpoint
- [ ] Create payment tracking endpoints
- [ ] Write comprehensive tests for all endpoints

### Phase 4: Client Management UI
- [ ] Create Clients page with route holder filter
- [ ] Build Add/Edit Client dialog with billing rate configuration
- [ ] Implement client list with search and filtering
- [ ] Add client summary cards showing billing stats
- [ ] Support three billing models: mileage-only, flat-fee per stop, hourly rate
- [ ] Handle $0.00 mileage rate for service-only billing

### Phase 5: Route Billing Integration
- [ ] Add client selector to route creation/editing
- [ ] Display client billing rates on route cards
- [ ] Calculate charges on route completion (mileage + stops)
- [ ] Store billing data with completed routes
- [ ] Implement PDF invoice generation with jsPDF
- [ ] Create invoice template with itemized charges
- [ ] Auto-mark routes as "billed" when invoice generated

### Phase 6: Billing Reports & Payment Tracking
- [ ] Add billing status filter to routes list
- [ ] Create billing report page with client filtering
- [ ] Show charge breakdowns (mileage vs stop charges)
- [ ] Implement bulk "Mark as Paid" action
- [ ] Add payment date tracking
- [ ] Create client billing summary view
- [ ] Add revenue reporting by route holder

### Phase 7: Testing & Documentation
- [ ] Test complete workflow: client creation → route completion → invoice → payment
- [ ] Test with multiple route holders managing separate clients
- [ ] Verify $0.00 mileage rate scenario (service-only billing)
- [ ] Test all three billing models (mileage-only, flat-fee, hourly)
- [ ] Create user guide for billing features
- [ ] Document route holder billing workflows
